import streamlit as st
import pandas as pd

# --- –û–±–ª–æ–∂–∫–∞ —Å–∞–π—Ç–∞ ---
st.image("data/images/banner.jpg", use_container_width=True)

# --- –ó–∞–≥–æ–ª–æ–≤–æ–∫ ---
st.markdown(
    """
    <h1 style='text-align: center; font-size: 48px; margin-top: -30px;'>
        DENE Store. –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!
    </h1>
    """,
    unsafe_allow_html=True
)

# --- –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ ---
@st.cache_data
def load_data():
    df = pd.read_excel("data/catalog.xlsx")
    df = df.fillna("")
    return df

df = load_data()

# --- –§–∏–ª—å—Ç—Ä—ã ---
brands = ["–í—Å–µ"] + sorted(df["brand"].unique().tolist())
selected_brand = st.selectbox("–í—ã–±–µ—Ä–∏—Ç–µ –±—Ä–µ–Ω–¥", brands)

# –ü–∞—Ä—Å–∏–º —Ä–∞–∑–º–µ—Ä –∏ –ø–æ–ª –∏–∑ model
# –ò–∑–≤–ª–µ–∫–∞–µ–º —Ä–∞–∑–º–µ—Ä (–æ–¥–Ω–æ —á–∏—Å–ª–æ, –∏–Ω–æ–≥–¥–∞ —Å .5)
df["size"] = df["model"].str.extract(r'(\d{1,2}(?:\.\d)?)')[0]

# –ò–∑–≤–ª–µ–∫–∞–µ–º –ø–æ–ª (men, women, kids, unisex)
df["gender"] = df["model"].str.extract(r'\b(men|women|kids|unisex)\b', expand=False).fillna("")

sizes = ["–í—Å–µ"] + sorted(df["size"].dropna().unique().tolist())
genders = ["–í—Å–µ"] + sorted(df["gender"].dropna().unique().tolist())

col1, col2 = st.columns(2)
with col1:
    selected_size = st.selectbox("–†–∞–∑–º–µ—Ä", sizes)
with col2:
    selected_gender = st.selectbox("–ü–æ–ª", genders)

# --- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è ---
filtered = df.copy()
if selected_brand != "–í—Å–µ":
    filtered = filtered[filtered["brand"] == selected_brand]
if selected_size != "–í—Å–µ":
    filtered = filtered[filtered["size"] == selected_size]
if selected_gender != "–í—Å–µ":
    filtered = filtered[filtered["gender"] == selected_gender]

# --- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ ---
st.divider()
if len(filtered) == 0:
    st.warning("‚ö†Ô∏è –¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã.")
else:
    cols = st.columns(3)
    for idx, (_, row) in enumerate(filtered.iterrows()):
        with cols[idx % 3]:
            st.image("https://via.placeholder.com/300x200?text=–§–æ—Ç–æ+—Ç–æ–≤–∞—Ä–∞", use_container_width=True)
            st.markdown(f"**{row['model']}**")
            st.markdown(f"üí∏ –¶–µ–Ω–∞: **{int(row['price'])} ‚Ç∏**")
            if st.button("üõí –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É", key=f"btn_{idx}"):
                st.success(f"{row['model']} –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É!")

# --- –°—Ç–∏–ª–∏ ---
st.markdown("""
    <style>
        .stButton>button {
            background-color: black;
            color: white;
            border-radius: 8px;
            padding: 8px 16px;
        }
        .stButton>button:hover {
            background-color: #444;
        }
    </style>
""", unsafe_allow_html=True)
