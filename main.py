import streamlit as st
import pandas as pd
import glob
import os
from PIL import Image

# --- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ---
st.set_page_config(page_title="DENE Store", layout="wide")

# --- –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö ---
catalog = pd.read_excel("data/catalog.xlsx").fillna("")
catalog.columns = catalog.columns.str.strip().str.lower()

# --- –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏ –∏–∑ –ø–æ–¥–ø–∞–ø–æ–∫ ---
image_paths = glob.glob("data/images/**/*.*", recursive=True)
image_dict = {}

for path in image_paths:
    filename = os.path.splitext(os.path.basename(path))[0]
    image_dict[filename] = path

# --- –ó–∞–≥–æ–ª–æ–≤–æ–∫ ---
st.markdown(
    """
    <h1 style='text-align:center; font-size:42px; margin-bottom:10px;'>üëü DENE Store</h1>
    <p style='text-align:center; color:gray;'>–ö–∞—Ç–∞–ª–æ–≥ –∫—Ä–æ—Å—Å–æ–≤–æ–∫</p>
    <hr style='margin-top:20px;'>
    """,
    unsafe_allow_html=True
)

# --- –°–µ—Ç–∫–∞ –∫–∞—Ä—Ç–æ—á–µ–∫ —Ç–æ–≤–∞—Ä–æ–≤ ---
num_cols = 3
rows = [catalog.iloc[i:i + num_cols] for i in range(0, len(catalog), num_cols)]

for row_df in rows:
    cols = st.columns(num_cols)
    for col, (_, row) in zip(cols, row_df.iterrows()):
        with col:
            # –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏ –¥–ª—è —Ç–æ–≤–∞—Ä–∞
            image_names = str(row["image"]).split()
            found_images = [image_dict[name] for name in image_names if name in image_dict]

            # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—É—é –∫–∞—Ä—Ç–∏–Ω–∫—É –∏–ª–∏ –∑–∞–≥–ª—É—à–∫—É
            if found_images:
                img = Image.open(found_images[0])
                st.image(img, use_container_width=True)
            else:
                st.image("data/images/no_image.jpg", use_container_width=True)

            # –ö–∞—Ä—Ç–æ—á–∫–∞ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º
            st.markdown(
                f"""
                <div style="
                    border:1px solid #eee;
                    border-radius:16px;
                    padding:12px;
                    margin-top:8px;
                    background-color:#fff;
                    box-shadow:0 2px 8px rgba(0,0,0,0.05);
                    text-align:center;
                ">
                    <h4 style="margin:4px 0;">{row['brand']} {row['model']}</h4>
                    <p style="color:gray; font-size:13px; margin:2px 0;">{row['color']} | {row['gender']}</p>
                    <p style="font-weight:bold; color:#111; margin:4px 0;">{int(row['price'])} ‚Ç∏</p>
                    <p style="font-size:13px; color:{'green' if row['in stock'] == 'yes' else 'red'};">
                        {'–í –Ω–∞–ª–∏—á–∏–∏' if row['in stock'] == 'yes' else '–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏'}
                    </p>
                </div>
                """,
                unsafe_allow_html=True
            )

st.divider()
st.caption("¬© DENE Store 2025")